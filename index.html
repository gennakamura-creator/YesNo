<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>レセスタ 導入前チェック</title>

  <style>
    :root{
      --bg:#f7f7f8;
      --card:#fff;
      --border:#e3e3e7;
      --text:#111;
      --muted:#666;

      --yes-bg:#E8F1FF;
      --yes-border:#B5D0FF;
      --yes-text:#1F4FD8;

      --no-bg:#FDECEC;
      --no-border:#F3B4B4;
      --no-text:#B42323;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* ✅ 全体を“真ん中”寄せ（縦も中央寄り） */
    .page{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;       /* ← 縦中央寄せ */
      padding:24px 16px;
    }
    .wrap{ width:min(880px,100%); }

    .header{
      display:flex;
      justify-content:flex-end; /* 左の案内を消したので右寄せのみ */
      gap:12px;
      margin:0 2px 10px;
      font-size:13px;
      color:var(--muted);
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:22px 18px;
      box-shadow:0 4px 18px rgba(0,0,0,0.05);
    }

    .title{
      margin:0 0 12px;
      font-size:20px;
      line-height:1.35;
      text-align:center;       /* 中央寄せ */
    }
    .detail{
      margin:0;
      line-height:1.65;
      white-space:pre-wrap;
      text-align:left;         /* 文章は左の方が読みやすいので維持 */
    }

    .note{
      margin-top:14px;
      font-size:12px;
      color:var(--muted);
      line-height:1.55;
      text-align:center;       /* 中央寄せ */
    }

    /* ✅ ボタンをカード直下・中央に */
    .actionArea{
      margin-top:18px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
    }

    button{
      appearance:none;
      border-radius:14px;
      padding:16px 12px;
      font-size:16px;
      font-weight:700;
      cursor:pointer;
      border:1px solid var(--border);
      background:#fff;
    }
    button:active{ transform:translateY(1px); }

    .yesBtn{
      background:var(--yes-bg);
      border-color:var(--yes-border);
      color:var(--yes-text);
    }
    .noBtn{
      background:var(--no-bg);
      border-color:var(--no-border);
      color:var(--no-text);
    }

    .secondary{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;  /* 中央寄せ */
    }
    .secondary button{
      font-size:14px;
      font-weight:650;
      padding:10px 12px;
      border-radius:12px;
      background:#fff;
      flex:1;
      min-width:160px;
      max-width:240px;
    }

    .hidden{ display:none !important; }

    .error{
      margin-top:10px;
      font-size:13px;
      color:#B00020;
      white-space:pre-wrap;
      text-align:left;
    }

    @media (max-width:520px){
      .actionArea{ grid-template-columns:1fr; }
      .secondary button{ min-width:unset; max-width:none; }
      .title{ text-align:left; } /* スマホは左の方が読みやすい場合が多いので */
      .note{ text-align:left; }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="wrap">
      <div class="header">
        <div>現在: <span id="nodeId">-</span></div>
      </div>

      <div class="card">
        <h1 id="qTitle" class="title"></h1>
        <p id="qDetail" class="detail"></p>
        <div id="qNote" class="note"></div>
        <div id="err" class="error"></div>

        <div class="actionArea">
          <!-- ✅ （↓）（→）を削除 -->
          <button id="yesBtn" class="yesBtn">Yes</button>
          <button id="noBtn" class="noBtn">No</button>
        </div>

        <div class="secondary">
          <button id="nextBtn" class="hidden">次へ</button>
          <button id="restartBtn" class="hidden">最初から</button>
          <button id="backBtn">ひとつ戻る</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const FLOW = {
    startId: "q1",
    nodes: {
      q1: {
        id: "q1",
        type: "question",
        text:
`レセスタの推奨環境のPCはありますか？
【推奨環境】
・最新OS
・電カル・レセコン同居不可
・その他 推奨環境に準拠`,
        yesTo: "q2",
        noTo: "m1_no"
      },

      m1_no: {
        id: "m1_no",
        type: "outcome",
        text:
`推奨環境のPCを用意して次にお進みください
（ご用意後、最初からやり直してください）`
      },

      q2: {
        id: "q2",
        type: "question",
        text: `利用予定の端末はインターネットに接続されていますか？`,
        yesTo: "q3",
        noTo: "m2_no"
      },

      m2_no: {
        id: "m2_no",
        type: "outcome",
        text:
`インターネット環境を整えてください
（整ったら最初からやり直してください）`
      },

      q3: {
        id: "q3",
        type: "question",
        text: `電子カルテ・レセコンと同居して使用しますか？`,
        yesTo: "m3_yes",
        noTo: "q4"
      },

      m3_yes: {
        id: "m3_yes",
        type: "outcome",
        text:
`同居利用の注意点
電カル：ホワイトリスト対応
レセコン：オンライン請求端末は推奨しておりません
別端末でのご利用を推奨しております
ご使用の場合は証明書の選択誤りにご注意ください`
      },

      q4: {
        id: "q4",
        type: "question",
        text:
`レセスタではメール登録が必要ですが、メールアドレスはありますか？
【注意】
・携帯キャリアのメールは不可です
・Yahoo / Google などは利用できます
【例】XXX@docomo… / xxx@ezweb…`,
        yesTo: "q5",
        noTo: "m4_no"
      },

      m4_no: {
        id: "m4_no",
        type: "outcome",
        text:
`携帯ではないメールアドレスを作成してください
（作成後、最初からやり直してください）`
      },

      q5: {
        id: "q5",
        type: "question",
        text: `使用予定の端末でそのメールを確認できますか？`,
        yesTo: "q6",
        noTo: "m5_no"
      },

      m5_no: {
        id: "m5_no",
        type: "outcome",
        text:
`メール受信のお願い
レセスタより「タイトル」のメールが届きますので、
添付ファイルを解凍して使用する端末に移動してください。

可能であれば、レセスタを使用するPCで
メールを受信できるよう設定してください`
      },

      q6: {
        id: "q6",
        type: "outcome",
        text: `お疲れ様でした（導入前チェック完了）`
      },

      q7: {
        id: "q7",
        type: "outcome",
        text:
`導入・運用開始のご案内
レセスタは縦覧点検に対応しています。
レセプト提出時の点検用データを
過去6ヶ月分程度ご準備ください。`
      }
    }
  };

  const OUTCOME_NEXT = {
    m3_yes: "q4",
    m5_no: "q6",
    q6: "q7"
  };

  const $ = (id) => document.getElementById(id);

  const nodeIdEl  = $("nodeId");
  const qTitleEl  = $("qTitle");
  const qDetailEl = $("qDetail");
  const qNoteEl   = $("qNote");
  const errEl     = $("err");

  const yesBtn     = $("yesBtn");
  const noBtn      = $("noBtn");
  const nextBtn    = $("nextBtn");
  const restartBtn = $("restartBtn");
  const backBtn    = $("backBtn");

  const historyStack = [];
  let currentId = FLOW.startId;

  function getNode(id){ return FLOW.nodes[id] || null; }

  function splitText(text){
    const lines = String(text || "").split("\n");
    const title = (lines.shift() || "").trim();
    const detail = lines.join("\n").trim();
    return { title, detail };
  }

  function validateFlowOnce(){
    const errors = [];
    if (!FLOW.startId || !getNode(FLOW.startId)) errors.push(`startId "${FLOW.startId}" が存在しません`);
    for (const [id, n] of Object.entries(FLOW.nodes)) {
      if (!n.text) errors.push(`"${id}" の text が空です`);
      if (n.type === "question") {
        if (!n.yesTo || !getNode(n.yesTo)) errors.push(`"${id}" の yesTo が不正（${n.yesTo}）`);
        if (!n.noTo  || !getNode(n.noTo))  errors.push(`"${id}" の noTo が不正（${n.noTo}）`);
      }
    }
    return errors;
  }

  function setButtons(mode, hasNext){
    if (mode === "question") {
      yesBtn.classList.remove("hidden");
      noBtn.classList.remove("hidden");
      nextBtn.classList.add("hidden");
      restartBtn.classList.add("hidden");
    } else {
      yesBtn.classList.add("hidden");
      noBtn.classList.add("hidden");
      if (hasNext) {
        nextBtn.classList.remove("hidden");
        restartBtn.classList.add("hidden");
      } else {
        nextBtn.classList.add("hidden");
        restartBtn.classList.remove("hidden");
      }
    }
  }

  function showNode(id, pushHistory = true){
    const n = getNode(id);
    if (!n) { errEl.textContent = `ノードが見つかりません: ${id}`; return; }

    errEl.textContent = "";
    if (pushHistory && currentId) historyStack.push(currentId);
    currentId = id;

    nodeIdEl.textContent = id;

    const { title, detail } = splitText(n.text);
    qTitleEl.textContent = title || "（無題）";
    qDetailEl.textContent = detail;

    if (n.type === "question") {
      setButtons("question", false);
      qNoteEl.textContent = "";
    } else {
      const next = OUTCOME_NEXT[id];
      setButtons("outcome", !!next);
      qNoteEl.textContent = next ? "" : "";
    }
  }

  function jump(nextId){ showNode(nextId, true); }

  yesBtn.addEventListener("click", () => {
    const n = getNode(currentId);
    if (n && n.type === "question") jump(n.yesTo);
  });

  noBtn.addEventListener("click", () => {
    const n = getNode(currentId);
    if (n && n.type === "question") jump(n.noTo);
  });

  nextBtn.addEventListener("click", () => {
    const next = OUTCOME_NEXT[currentId];
    if (next) jump(next);
  });

  restartBtn.addEventListener("click", () => {
    historyStack.length = 0;
    showNode(FLOW.startId, false);
  });

  backBtn.addEventListener("click", () => {
    const prev = historyStack.pop();
    if (prev) showNode(prev, false);
  });

  const errs = validateFlowOnce();
  if (errs.length) errEl.textContent = "設定エラー:\n" + errs.join("\n");

  showNode(FLOW.startId, false);
</script>
</body>
</html>
